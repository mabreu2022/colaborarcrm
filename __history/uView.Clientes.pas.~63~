unit uView.Clientes;

{ Copyright 2025 / 2026 D2Bridge Framework by Talis Jonatas Gomes }

interface

uses
  Winapi.Windows,
  Winapi.Messages,
  System.SysUtils,
  System.Variants,
  System.Classes,
  Vcl.Graphics,
  Vcl.Controls,
  Vcl.Forms,
  Vcl.Dialogs,
  Vcl.StdCtrls,
  Unit1,
  D2Bridge.Forms, Vcl.ComCtrls, Data.DB, Vcl.ExtCtrls, Vcl.Grids, Vcl.DBGrids;

type
  TFrmClientes = class(TForm1)
    PageControl1: TPageControl;
    Cadastro: TTabSheet;
    Listagem: TTabSheet;
    edtRazao_Nome: TEdit;
    edtFantasia: TEdit;
    DBGrid1: TDBGrid;
    Panel1: TPanel;
    Panel2: TPanel;
    EdtPesquisar: TEdit;
    btnPesquisar: TButton;
    lblLocalizar: TLabel;
    lblRazao: TLabel;
    lblFantasia: TLabel;
    lblCPFCNPJ: TLabel;
    lblIE: TLabel;
    lblTipoPessoa: TLabel;
    lblTelefone: TLabel;
    lblEndereco: TLabel;
    lblComplemento: TLabel;
    lblCEP: TLabel;
    lblMunicipio: TLabel;
    lblUF: TLabel;
    Label10: TLabel;
    Label11: TLabel;
    Label12: TLabel;
    Label13: TLabel;
    Label14: TLabel;
    Label15: TLabel;
    Label16: TLabel;
    Label17: TLabel;
    edtCPFCNPJ: TEdit;
    edtIE: TEdit;
    edtTelefone: TEdit;
    lblEmail: TLabel;
    edtEmail: TEdit;
    edtEndereco: TEdit;
    lblNumero: TLabel;
    edtNumero: TEdit;
    edtComplemento: TEdit;
    lblBairro: TLabel;
    edtBairro: TEdit;
    edtCEP: TEdit;
    edtMunicipio: TEdit;
    ComboBox1: TComboBox;
    cmbUF: TComboBox;
    Panel3: TPanel;
    btnInserir: TButton;
    btnEditar: TButton;
    btnExcluir: TButton;
    procedure FormShow(Sender: TObject);
    procedure btnPesquisarClick(Sender: TObject);
    procedure btnInserirClick(Sender: TObject);
    procedure btnEditarClick(Sender: TObject);
    procedure btnExcluirClick(Sender: TObject);
  private
    procedure Listarclientes;
    { Private declarations }
  public
    { Public declarations }
  protected
    procedure ExportD2Bridge; override;
    procedure InitControlsD2Bridge(const PrismControl: TPrismControl); override;
    procedure RenderD2Bridge(const PrismControl: TPrismControl;
      var HTMLControl: string); override;
  end;

function FrmClientes: TFrmClientes;

implementation

Uses
  ContratosWebApp, uDM;

{$R *.dfm}

function FrmClientes: TFrmClientes;
begin
  result := TFrmClientes(TFrmClientes.GetInstance);
end;

procedure TFrmClientes.btnEditarClick(Sender: TObject);
begin
  inherited;
  //
end;

procedure TFrmClientes.btnExcluirClick(Sender: TObject);
begin
  inherited;
  //
end;

procedure TFrmClientes.btnInserirClick(Sender: TObject);
begin
  inherited;
  //
end;

procedure TFrmClientes.btnPesquisarClick(Sender: TObject);
begin
  inherited;
  Listarclientes;
end;

procedure TFrmClientes.ExportD2Bridge;
begin
  inherited;

  Title := 'Cadastro de Clientes';

  // TemplateClassForm:= TD2BridgeFormTemplate;
  D2Bridge.FrameworkExportType.TemplateMasterHTMLFile := '';
  D2Bridge.FrameworkExportType.TemplatePageHTMLFile := '';

  with D2Bridge.Items.add do
  begin
    with Row.Items.add do
      with Tabs do
      begin

        with AddTab(PageControl1.Pages[0].Caption).Items.add do
        begin
          with Row.Items.add do
          begin
            Col.Items.add.FormGroup(lblRazao.Caption).AddVCLObj(edtRazao_Nome);
            Col.Items.add.FormGroup(lblFantasia.Caption).AddVCLObj(edtFantasia);
          end;

          // Segunda linha com "Tipo" e "I.E."
          with Row.Items.add do
          begin
            Col.Items.add.FormGroup(lblTipoPessoa.Caption).AddVCLObj(ComboBox1);
            Col.Items.add.FormGroup(lblCPFCNPJ.Caption).AddVCLObj(edtCPFCNPJ);
          end;

          // if edtTipoPessoa.Text = 'F' then
          // begin
          // with Row.Items.add do
          // begin
          // Col.Items.add.FormGroup(lblRG.Caption).AddVCLObj(edtRG);
          // Col.Items.add.FormGroup(lblDataNascimento.Caption).AddVCLObj(dtDataNascimento);
          // end;
          // end;

          with Row.Items.add do
          begin
            Col.Items.add.FormGroup(lblIE.Caption).AddVCLObj(edtIE);
            Col.Items.add.FormGroup(lblTelefone.Caption).AddVCLObj(edtTelefone);
          end;

          with Row.Items.add do
          begin
            Col.Items.add.FormGroup(lblEmail.Caption).AddVCLObj(edtEmail);
            Col.Items.add.FormGroup(lblEndereco.Caption).AddVCLObj(edtEndereco);
          end;

          with Row.Items.add do
          begin
            Col.Items.add.FormGroup(lblNumero.Caption).AddVCLObj(edtNumero);
            Col.Items.add.FormGroup(lblComplemento.Caption)
              .AddVCLObj(edtComplemento);
          end;

          with Row.Items.add do
          begin
            Col.Items.add.FormGroup(lblBairro.Caption).AddVCLObj(edtBairro);
            Col.Items.add.FormGroup(lblMunicipio.Caption)
              .AddVCLObj(edtMunicipio);
          end;

          with Row.Items.add do
          begin
            Col.Items.add.FormGroup(lblCEP.Caption).AddVCLObj(edtCEP);
            Col.Items.add.FormGroup(lblUF.Caption).AddVCLObj(cmbUF);
            // Col.Items.add.FormGroup(lblCodMunicipio.Caption).AddVCLObj(edtCodMunicipio);
          end;

          // with Row.Items.add do
          // begin
          // Col.Items.add.FormGroup(lblPais.Caption).AddVCLObj(edtPais);
          // Col.Items.add.FormGroup(lblCodPais.Caption).AddVCLObj(edtCodPais);
          // end;

          with Row.Items.add do
          begin
            with Col.Items.add do
            begin
              FormGroup('  ').AddVCLObj(btnInserir,
                'btn btn-success bi bi-send');
              FormGroup('  ').AddVCLObj(btnEditar,
                'btn btn-primary bi bi-send');
              FormGroup('  ').AddVCLObj(btnExcluir,
                'btn btn-danger bi bi-sender');
            end;
          end;

        end;

        with AddTab(PageControl1.Pages[1].Caption).Items.add do
        begin
          with Row.Items.add do
          begin
            FormGroup(lblLocalizar.Caption).AddVCLObj(EdtPesquisar);
            FormGroup('').AddVCLObj(btnPesquisar);

          end;
          with Row.Items.add do
            VCLObj(DBGrid1);
        end;

      end;
  end;

end;

procedure TFrmClientes.Listarclientes;
begin
  DM.Listarclientes(EdtPesquisar.Text);
end;

procedure TFrmClientes.FormShow(Sender: TObject);
begin
  inherited;
  Listarclientes;
end;

procedure TFrmClientes.InitControlsD2Bridge(const PrismControl: TPrismControl);
begin
  inherited;

  // Change Init Property of Prism Controls
  {
    if PrismControl.VCLComponent = Edit1 then
    PrismControl.AsEdit.DataType:= TPrismFieldType.PrismFieldTypeInteger;

    if PrismControl.IsDBGrid then
    begin
    PrismControl.AsDBGrid.RecordsPerPage:= 10;
    PrismControl.AsDBGrid.MaxRecords:= 2000;
    end;
  }
end;

procedure TFrmClientes.RenderD2Bridge(const PrismControl: TPrismControl;
  var HTMLControl: string);
begin
  inherited;

  // Intercept HTML
  {
    if PrismControl.VCLComponent = Edit1 then
    begin
    HTMLControl:= '</>';
    end;
  }
end;

end.
